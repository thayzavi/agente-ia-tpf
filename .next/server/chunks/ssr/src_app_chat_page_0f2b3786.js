module.exports=[12692,a=>{"use strict";a.s(["default",()=>u],12692);var b=a.i(87924),c=a.i(72131),d=a.i(35112),e=a.i(27348);function f({conversation:a,onRename:f,onDelete:g,onSelect:h,isActive:i}){let[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)({top:0,left:0}),n=(0,c.useRef)(null),o=(0,c.useRef)(null),p=()=>k(!1),q=b=>{b.stopPropagation(),f?.(a),p()},r=b=>{b.stopPropagation(),g?.(a),p()};return(0,c.useEffect)(()=>{let a=a=>{let b=a.target;n.current&&!n.current.contains(b)&&o.current&&!o.current.contains(b)&&k(!1)},b=a=>{"Escape"===a.key&&k(!1)};return document.addEventListener("mousedown",a),document.addEventListener("touchstart",a),document.addEventListener("keydown",b),()=>{document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a),document.removeEventListener("keydown",b)}},[]),(0,c.useEffect)(()=>{if(!j)return;let a=()=>{if(!n.current)return;let a=n.current.getBoundingClientRect();m({top:a.top+window.scrollY,left:a.right+12})};return window.addEventListener("scroll",a,{passive:!0}),window.addEventListener("resize",a),()=>{window.removeEventListener("scroll",a),window.removeEventListener("resize",a)}},[j]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:`sidebar-item ${i?"active":""}`,onClick:()=>h?.(a),children:[(0,b.jsx)("span",{className:"sidebar-text",children:a.title||"Chat sem nome"}),(0,b.jsx)("div",{className:"dots-menu",ref:n,onClick:a=>{if(a.stopPropagation(),j)p();else{if(a.stopPropagation(),n.current){let a=n.current.getBoundingClientRect();m({top:a.top+window.scrollY,left:a.right+12})}k(!0)}},role:"button","aria-haspopup":"menu","aria-expanded":j,children:(0,b.jsx)("span",{className:"dots",children:"⋮"})})]}),j&&(0,d.createPortal)((0,b.jsxs)("div",{className:"floating-dropdown",ref:o,style:{position:"absolute",top:`${l.top}px`,left:`${l.left}px`,zIndex:99999},role:"menu",children:[(0,b.jsxs)("p",{onClick:q,role:"menuitem",tabIndex:0,onKeyDown:a=>("Enter"===a.key||" "===a.key)&&q(a),children:[(0,b.jsx)(e.FiEdit,{className:"icon"})," Renomear"]}),(0,b.jsxs)("p",{onClick:r,role:"menuitem",tabIndex:0,onKeyDown:a=>("Enter"===a.key||" "===a.key)&&r(a),children:[(0,b.jsx)(e.FiTrash2,{className:"icon"})," Excluir"]})]}),document.body)]})}function g({type:a,chatTitle:d,onClose:e,onConfirm:f}){let[g,h]=(0,c.useState)(d||""),i=(0,c.useRef)(null),j="renomear"===a,k="excluir"===a;return(0,c.useEffect)(()=>{j&&i.current?.focus();let a=a=>{"Escape"===a.key&&e()};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[j,e]),(0,b.jsx)("div",{className:"modal-overlay",children:(0,b.jsxs)("div",{className:"modal modal-animate",role:"dialog","aria-modal":"true",children:[k&&(0,b.jsxs)("p",{children:['Deseja realmente excluir o chat "',d,'" ? Essa ação é irreversível e as mensagens desse chat serão apagadas']}),j&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{children:"Renomear chat:"}),(0,b.jsx)("input",{ref:i,type:"text",value:g,onChange:a=>h(a.target.value),onKeyPress:a=>"Enter"===a.key&&void((!j||g.trim())&&f(j?g.trim():void 0)),maxLength:50})]}),(0,b.jsxs)("div",{className:"modal-actions",children:[(0,b.jsx)("button",{className:"cancelar",onClick:e,children:"Cancelar"}),(0,b.jsx)("button",{className:"confirm",onClick:()=>f(j?g.trim():void 0),children:k?"Confirmar Exclusão":"Salvar Novo Nome"})]})]})})}var h=a.i(60934),i=a.i(42343);function j(a){return(0,i.GenIcon)({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"},child:[]}]})(a)}function k(a){return(0,i.GenIcon)({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"},child:[]}]})(a)}function l({documentId:a}){let[d,e]=(0,c.useState)(null),[f,g]=(0,c.useState)("Documento Gerado"),[i,k]=(0,c.useState)(!0);return((0,c.useEffect)(()=>{(async()=>{if(a)try{let b=await h.api.getDocumentMetadata(a);e(b.gridfs_file_id),g(b.filename||"Documento Gerado")}catch(a){console.error("Erro ao buscar metadados do arquivo:",a)}finally{k(!1)}})()},[a]),i)?(0,b.jsx)("small",{children:"Carregando link do documento..."}):d?(0,b.jsxs)("a",{href:`${h.api.API_BASE_URL}/api/files/${d}`,target:"_blank",rel:"noopener noreferrer",className:"document-download-link",children:[(0,b.jsx)(j,{})," Baixar: ",f]}):(0,b.jsx)("small",{children:"Link de download indisponível."})}function m(a){return(0,i.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"},child:[]}]})(a)}function n(a){return(0,i.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10zM8 13.01l1.41 1.41L11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01z"},child:[]}]})(a)}function o(a){return(0,i.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(a)}function p(a){return(0,i.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"},child:[]}]})(a)}function q({onFileUploaded:a,onClose:d,activeConversation:e}){let[f,g]=(0,c.useState)(!1),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)([]),[o,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(1);(0,c.useEffect)(()=>{2===t&&v()},[t]);let v=async()=>{try{g(!0);let a=await h.api.getTemplates();l(a||[])}catch(a){console.error("Erro ao carregar templates:",a),j("Erro ao carregar templates. Tente novamente.")}finally{g(!1)}},w=async a=>{if(!a||!e)return void j("Selecione um arquivo e verifique a conversa ativa.");g(!0),j(null);try{let b=await h.api.uploadDocument(a),c=b?.document?._id||b?._id;if(!c)throw Error("ID do documento não recebido da API.");q({id:c,name:a.name,file:a}),u(2)}catch(a){console.error("Erro no upload do arquivo:",a),j(a.message||"Erro ao enviar arquivo.")}finally{g(!1)}},x=async b=>{if(o)try{let c={documentId:o.id,templateId:b._id,fileName:o.name,templateName:b.name};console.log("Processando:",c),a&&a(o.id,o.name,b._id),d()}catch(a){console.error("Erro ao processar:",a),j("Erro ao selecionar template.")}};return(0,b.jsx)("div",{className:"modal-overlay",children:(0,b.jsxs)("div",{className:"modal add-file-modal modal-animate",children:[(0,b.jsxs)("div",{className:"modal-header",children:[(0,b.jsx)("h3",{children:1===t?"Enviar Arquivo":"Selecionar Template"}),(0,b.jsx)("button",{className:"close-modal-btn",onClick:d,children:(0,b.jsx)(p,{})})]}),(0,b.jsx)("div",{className:"modal-steps",children:(0,b.jsxs)("div",{className:"step-indicator",children:[(0,b.jsxs)("div",{className:`step ${t>=1?"active":""}`,children:[(0,b.jsx)("span",{children:"1"}),"Upload"]}),(0,b.jsx)("div",{className:"step-connector"}),(0,b.jsxs)("div",{className:`step ${t>=2?"active":""}`,children:[(0,b.jsx)("span",{children:"2"}),"Template"]})]})}),(0,b.jsxs)("div",{className:"modal-content",children:[i&&(0,b.jsx)("p",{className:"error-message",children:i}),1===t&&(0,b.jsxs)("div",{className:"upload-section",children:[(0,b.jsx)("p",{className:"modal-description",children:"Faça upload do arquivo que você deseja processar (DOC, DOCX, XLSX, etc.)"}),(0,b.jsxs)("label",{className:`file-upload-label ${f?"disabled":""}`,children:[(0,b.jsx)(n,{className:"upload-icon"}),(0,b.jsx)("span",{children:f?"Enviando...":"Escolher Arquivo"}),(0,b.jsx)("input",{type:"file",onChange:a=>{let b=a.target.files[0];b&&w(b)},disabled:f,style:{display:"none"},accept:".doc,.docx,.xlsx,.xls,.pdf,.txt"})]}),(0,b.jsx)("div",{className:"supported-formats",children:(0,b.jsx)("small",{children:"Formatos suportados: DOC, DOCX, XLSX, XLS, PDF, TXT"})})]}),2===t&&o&&(0,b.jsxs)("div",{className:"templates-section",children:[(0,b.jsxs)("div",{className:"uploaded-file-info",children:[(0,b.jsx)(m,{className:"file-icon"}),(0,b.jsxs)("div",{className:"file-details",children:[(0,b.jsx)("span",{className:"file-name",children:o.name}),(0,b.jsx)("span",{className:"file-status",children:"✓ Arquivo enviado com sucesso"})]}),(0,b.jsx)("button",{className:"change-file-btn",onClick:()=>{u(1),q(null),s(null),j(null)},children:"Alterar"})]}),(0,b.jsx)("p",{className:"modal-description",children:"Selecione um template para processar o arquivo:"}),f?(0,b.jsx)("div",{className:"loading-templates",children:(0,b.jsx)("p",{children:"Carregando templates..."})}):(0,b.jsxs)("div",{className:"templates-list",children:[k.map(a=>(0,b.jsxs)("div",{className:`template_name ${r?._id===a._id?"selected":""}`,onClick:()=>x(a),children:[(0,b.jsx)(m,{className:"template-icon"}),(0,b.jsxs)("div",{className:"template-info",children:[(0,b.jsx)("span",{className:"template-name",children:a.name}),a.description&&(0,b.jsx)("span",{className:"template-description",children:a.description})]})]},a._id)),0===k.length&&(0,b.jsxs)("div",{className:"no-templates",children:[(0,b.jsx)(m,{className:"no-templates-icon"}),(0,b.jsx)("p",{children:"Nenhum template disponível"}),(0,b.jsx)("small",{children:"Entre em contato com o administrador para adicionar templates."})]})]})]})]})]})})}function r({onLogout:a,userEmail:c}){return(0,b.jsxs)("div",{className:"profile-menu",children:[(0,b.jsx)("div",{className:"profile-info",children:(0,b.jsx)("span",{children:c})}),(0,b.jsx)("button",{className:"profile-option",onClick:()=>{"function"==typeof a&&a()},type:"button",children:(0,b.jsx)("span",{children:"Sair"})})]})}function s({documentId:a,fileName:c,onRemove:d,showRemove:e=!0}){return(0,b.jsxs)("div",{className:"file",children:[(0,b.jsxs)("div",{className:"file-info",children:[(0,b.jsx)(m,{className:"file-icon"}),(0,b.jsx)("span",{className:"file-name",title:c,children:c||`Documento ${a?.substring(0,8)}`})]}),e&&(0,b.jsx)("button",{className:"remove-file-btn",onClick:a=>{a.stopPropagation(),d?.()},title:"Remover arquivo",children:(0,b.jsx)(o,{})})]})}function t({activeConversation:a,onOpenAddFileModal:d,onMessageSent:f,attachedDocumentId:g,setAttachedDocumentId:i,attachedFileName:j,setAttachedFileName:k,attachedTemplateId:l,setAttachedTemplateId:m}){let[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(!1),r=async()=>{let b=n.trim();if(a&&(b||g)&&!p){q(!0);try{f?.({sender:"user",content:b||"Processar arquivo com template",id:crypto.randomUUID(),attachedDocumentId:g,attachedFileName:j,templateId:l});let c=a?._id||a?.id,d=await h.api.sendMessage(b||"Processar este arquivo com o template selecionado",c,g,l);i(null),k(null),m(null),f?.({sender:"bot",content:d?.message_content||d?.content||"Processamento concluído",id:crypto.randomUUID(),generated_document_id:d?.document_id})}catch(a){console.error("Erro ao enviar mensagem:",a),f?.({sender:"bot",content:"Erro de conexão ou servidor. Tente novamente.",id:crypto.randomUUID()})}finally{q(!1),o("")}}},t=()=>{i(null),k(null),m(null)};return(0,b.jsxs)("div",{className:"chat-input-container",children:[(g||l)&&(0,b.jsxs)("div",{className:"attachment-preview",children:[g&&(0,b.jsx)(s,{documentId:g,fileName:j,onRemove:t}),l&&(0,b.jsxs)("div",{className:"template-attachment",children:[(0,b.jsxs)("div",{className:"file-info",children:[(0,b.jsx)("span",{className:"file-icon",children:"📄"}),(0,b.jsx)("span",{className:"file-name",children:"Template selecionado"})]}),(0,b.jsx)("button",{className:"remove-file-btn",onClick:g?()=>{m(null)}:t,title:"Remover template",children:"×"})]})]}),(0,b.jsxs)("div",{className:`chat-input ${g||l?"has-attachment":""}`,children:[(0,b.jsx)("button",{className:"add-file-btn",onClick:d,disabled:p,title:"Anexar arquivo e template",children:(0,b.jsx)(e.FiPlus,{className:g?"attached-icon":""})}),(0,b.jsx)("input",{type:"text",placeholder:g&&l?"Digite instruções para processar o arquivo com o template...":g?"Digite suas instruções para o documento...":p?"Aguardando resposta...":"Digite sua mensagem...",value:n,onChange:a=>o(a.target.value),onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),r())},disabled:p}),(0,b.jsx)("button",{className:"send-btn",onClick:r,disabled:p||!n.trim()&&!g,title:"Enviar mensagem",children:(0,b.jsx)(e.FiSend,{})})]})]})}function u(){let[a,d]=(0,c.useState)([]),[e,i]=(0,c.useState)(null),[j,m]=(0,c.useState)([]),[n,o]=(0,c.useState)({name:"Carregando...",email:"carregando@email.com"}),[p,s]=(0,c.useState)(null),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(null),E=(0,c.useRef)(null);(0,c.useEffect)(()=>{(async()=>{try{if(!localStorage.getItem("token"))return;let[a,b]=await Promise.all([h.api.getConversations(),h.api.getProfile()]);if(d(a),o({name:b.name,email:b.email}),a.length)F(a[0]);else{let a=await h.api.sendMessage("Olá, TPF-AI!");d(b=>[a.conversation,...b]),F(a.conversation)}}catch(a){console.error("Erro ao carregar chat:",a.message)}})()},[]),(0,c.useEffect)(()=>{E.current&&(E.current.scrollTop=E.current.scrollHeight)},[j]);let F=async a=>{i(a),z(null),B(null),D(null);try{let b=await h.api.getConversationHistory(a._id||a.id);m(b||[])}catch{m([])}},G=async(a,b)=>{if(!a||!b)return alert("Título obrigatório");try{await h.api.renameConversation(a,b),d(c=>c.map(c=>c._id===a?{...c,title:b}:c)),I()}catch(a){alert("Erro ao renomear: "+a.message)}},H=async b=>{if(!b)return alert("ID da conversa não encontrado");try{await h.api.deleteConversation(b);let c=a.filter(a=>a._id!==b);d(c),e&&e._id===b&&F(c[0]||null),I()}catch(a){alert("Erro ao excluir: "+a.message)}},I=()=>s(null);return(0,b.jsxs)("div",{className:"chat-container",children:[(0,b.jsxs)("aside",{className:"sidebar",children:[(0,b.jsxs)("h1",{className:"logo",children:["TPF",(0,b.jsx)("span",{children:"-AI"})]}),(0,b.jsx)("button",{className:"new-chat",onClick:async()=>{try{i(null),m([]),z(null),B(null),D(null);let a=await h.api.sendMessage("Novo chat iniciado");if(!a||!a.conversation_id)throw Error("API não retornou o ID da nova conversa.");let b=await h.api.getConversations(),c=b.find(b=>b._id===a.conversation_id)||b[0];if(!c)throw Error("Falha ao recuperar os dados da nova conversa.");d(b),F(c)}catch(a){console.error("Erro ao criar novo chat:",a.message)}},children:"+ Novo Chat"}),(0,b.jsx)("h4",{children:"Histórico"}),(0,b.jsx)("div",{className:"chat-list",children:a.filter(a=>a&&a._id).map(a=>(0,b.jsx)(f,{conversation:a,onRename:a=>s({type:"renomear",chat:a}),onDelete:a=>s({type:"excluir",chat:a}),onSelect:F,isActive:e&&e._id===a._id},a._id))}),(0,b.jsxs)("div",{className:"user-profile",onClick:()=>v(!u),children:[(0,b.jsx)("div",{className:"user-icon-container",children:(0,b.jsx)(k,{size:32,color:"#000000ff"})}),(0,b.jsx)("span",{children:n.name}),u&&(0,b.jsx)(r,{onLogout:()=>window.location.href="/auth/login",userEmail:n.email})]})]}),(0,b.jsxs)("main",{className:"chat-main",children:[(0,b.jsx)("div",{className:"chat-messages",ref:E,children:j.map(a=>(0,b.jsxs)("div",{className:`message-bubble ${"user"===a.role?"user":"bot"}`,children:[a.content,a.document_id&&(0,b.jsx)(l,{documentId:a.document_id})]},a._id||a.id))}),(0,b.jsx)(t,{activeConversation:e,onMessageSent:a=>m(b=>[...b,a]),onOpenAddFileModal:()=>x(!0),attachedDocumentId:y,setAttachedDocumentId:z,attachedFileName:A,setAttachedFileName:B,attachedTemplateId:C,setAttachedTemplateId:D})]}),p&&p.chat&&(0,b.jsx)(g,{type:p.type,chatTitle:p.chat.title,onClose:I,onConfirm:"renomear"===p.type?a=>G(p.chat._id,a):()=>H(p.chat._id)}),w&&(0,b.jsx)(q,{onClose:()=>x(!1),activeConversation:e,onFileUploaded:(a,b,c)=>{z(a),B(b),D(c),x(!1),alert(`Arquivo "${b}" e template selecionado! Digite suas instru\xe7\xf5es.`)}})]})}}];

//# sourceMappingURL=src_app_chat_page_0f2b3786.js.map