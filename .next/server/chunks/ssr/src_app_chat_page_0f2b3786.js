module.exports=[12692,a=>{"use strict";a.s(["default",()=>p],12692);var b=a.i(87924),c=a.i(72131),d=a.i(35112),e=a.i(27348);function f({conversation:a,onRename:f,onDelete:g,onSelect:h,isActive:i}){let[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)({top:0,left:0}),n=(0,c.useRef)(null),o=(0,c.useRef)(null),p=()=>k(!1),q=b=>{b.stopPropagation(),f?.(a),p()},r=b=>{b.stopPropagation(),g?.(a),p()};return(0,c.useEffect)(()=>{let a=a=>{let b=a.target;n.current&&!n.current.contains(b)&&o.current&&!o.current.contains(b)&&k(!1)},b=a=>{"Escape"===a.key&&k(!1)};return document.addEventListener("mousedown",a),document.addEventListener("touchstart",a),document.addEventListener("keydown",b),()=>{document.removeEventListener("mousedown",a),document.removeEventListener("touchstart",a),document.removeEventListener("keydown",b)}},[]),(0,c.useEffect)(()=>{if(!j)return;let a=()=>{if(!n.current)return;let a=n.current.getBoundingClientRect();m({top:a.top+window.scrollY,left:a.right+12})};return window.addEventListener("scroll",a,{passive:!0}),window.addEventListener("resize",a),()=>{window.removeEventListener("scroll",a),window.removeEventListener("resize",a)}},[j]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:`sidebar-item ${i?"active":""}`,onClick:()=>h?.(a),children:[(0,b.jsx)("span",{className:"sidebar-text",children:a.title||"Chat sem nome"}),(0,b.jsx)("div",{className:"dots-menu",ref:n,onClick:a=>{if(a.stopPropagation(),j)p();else{if(a.stopPropagation(),n.current){let a=n.current.getBoundingClientRect();m({top:a.top+window.scrollY,left:a.right+12})}k(!0)}},role:"button","aria-haspopup":"menu","aria-expanded":j,children:(0,b.jsx)("span",{className:"dots",children:"⋮"})})]}),j&&(0,d.createPortal)((0,b.jsxs)("div",{className:"floating-dropdown",ref:o,style:{position:"absolute",top:`${l.top}px`,left:`${l.left}px`,zIndex:99999},role:"menu",children:[(0,b.jsxs)("p",{onClick:q,role:"menuitem",tabIndex:0,onKeyDown:a=>("Enter"===a.key||" "===a.key)&&q(a),children:[(0,b.jsx)(e.FiEdit,{className:"icon"})," Renomear"]}),(0,b.jsxs)("p",{onClick:r,role:"menuitem",tabIndex:0,onKeyDown:a=>("Enter"===a.key||" "===a.key)&&r(a),children:[(0,b.jsx)(e.FiTrash2,{className:"icon"})," Excluir"]})]}),document.body)]})}function g({type:a,chatTitle:d,onClose:e,onConfirm:f}){let[g,h]=(0,c.useState)(d||""),i=(0,c.useRef)(null),j="renomear"===a,k="excluir"===a;return(0,c.useEffect)(()=>{j&&i.current?.focus();let a=a=>{"Escape"===a.key&&e()};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[j,e]),(0,b.jsx)("div",{className:"modal-overlay",children:(0,b.jsxs)("div",{className:"modal modal-animate",role:"dialog","aria-modal":"true",children:[k&&(0,b.jsxs)("p",{children:['Deseja realmente excluir o chat "',d,'" ? Essa ação é irreversível e as mensagens desse chat serão apagadas']}),j&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{children:"Renomear chat:"}),(0,b.jsx)("input",{ref:i,type:"text",value:g,onChange:a=>h(a.target.value),onKeyPress:a=>"Enter"===a.key&&void((!j||g.trim())&&f(j?g.trim():void 0)),maxLength:50})]}),(0,b.jsxs)("div",{className:"modal-actions",children:[(0,b.jsx)("button",{className:"cancelar",onClick:e,children:"Cancelar"}),(0,b.jsx)("button",{className:"confirm",onClick:()=>f(j?g.trim():void 0),children:k?"Confirmar Exclusão":"Salvar Novo Nome"})]})]})})}var h=a.i(42343);function i(a){return(0,h.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10zM8 13.01l1.41 1.41L11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01z"},child:[]}]})(a)}function j(a){return(0,h.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"},child:[]}]})(a)}var k=a.i(60934);function l({onFileUploaded:a,onClose:d,activeConversation:e}){let[f,g]=(0,c.useState)(!1),[h,l]=(0,c.useState)(null),m=async b=>{let c=b.target.files[0];if(c&&e){g(!0),l(null);try{let b=await k.api.uploadDocument(c),e=b?.document?._id;if(!e)throw Error("ID do documento não recebido da API. Verifique a resposta do servidor.");alert(`Arquivo "${c.name}" enviado com sucesso!`),a&&e&&a(e),d()}catch(a){console.error("Erro no upload do arquivo:",a),l(a.message||"Erro ao enviar arquivo.")}finally{g(!1)}}};return(0,b.jsx)("div",{className:"modal-overlay",children:(0,b.jsxs)("div",{className:"modal add-file-modal modal-animate",children:[(0,b.jsxs)("div",{className:"modal-header",children:[(0,b.jsx)("h3",{children:"Adicionar Arquivo"}),(0,b.jsx)("button",{className:"close-modal-btn",onClick:d,disabled:f,children:(0,b.jsx)(j,{})})]}),(0,b.jsxs)("div",{className:"modal-content",children:[h&&(0,b.jsx)("p",{className:"error-message",children:h}),(0,b.jsxs)("label",{className:`file-upload-label ${f?"disabled":""}`,children:[(0,b.jsx)(i,{className:"upload-icon"}),(0,b.jsx)("span",{children:f?"Processando...":"Escolher Arquivo"}),(0,b.jsx)("input",{type:"file",onChange:m,disabled:f,style:{display:"none"}})]})]})]})})}function m({onLogout:a,userEmail:c}){return(0,b.jsxs)("div",{className:"profile-menu",children:[(0,b.jsx)("div",{className:"profile-info",children:(0,b.jsx)("span",{children:c})}),(0,b.jsx)("button",{className:"profile-option",onClick:()=>{"function"==typeof a&&a()},type:"button",children:(0,b.jsx)("span",{children:"Sair"})})]})}function n({activeConversation:a,onOpenAddFileModal:d,onMessageSent:f,attachedDocumentId:g,setAttachedDocumentId:h}){let[i,j]=(0,c.useState)(""),[l,m]=(0,c.useState)(!1),n=async()=>{let b=i.trim();if(a&&(b||g)&&!l){m(!0),j(""),f?.({sender:"user",content:b,id:crypto.randomUUID()});try{let c=a?._id||a?.id,d=await k.api.sendMessage(b,c,g);h(null),f?.({sender:"bot",content:d?.message_content||d?.content||d?.mensagem||"Resposta da IA não recebida.",id:crypto.randomUUID(),generated_document_id:d?.document_id})}catch(b){console.error("Erro ao enviar mensagem:",b);let a=g?"Erro de conexão/servidor. O anexo foi mantido. Tente novamente.":"Erro de conexão ou servidor. Tente novamente.";f?.({sender:"bot",content:a,id:crypto.randomUUID()})}finally{m(!1)}}},o=g?`Documento anexado (${g.substring(0,4)}...). Digite sua instru\xe7\xe3o...`:l?"Aguardando resposta...":"Digite sua mensagem...";return(0,b.jsxs)("div",{className:`chat-input ${g?"has-attachment":""}`,children:[(0,b.jsx)("button",{className:"add-file-btn",onClick:d,disabled:l,children:(0,b.jsx)(e.FiPlus,{className:g?"attached-icon":""})}),(0,b.jsx)("input",{type:"text",placeholder:o,value:i,onChange:a=>j(a.target.value),onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),n())},disabled:l}),(0,b.jsx)("button",{className:"send-btn",onClick:n,disabled:l||!i.trim()&&!g,children:(0,b.jsx)(e.FiSend,{})})]})}function o(a){return(0,h.GenIcon)({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"},child:[]}]})(a)}function p(){let[a,d]=(0,c.useState)([]),[e,h]=(0,c.useState)(null),[i,j]=(0,c.useState)([]),[p,q]=(0,c.useState)({name:"Carregando...",email:"carregando@email.com"}),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(null),z=(0,c.useRef)(null);(0,c.useEffect)(()=>{(async()=>{try{if(!localStorage.getItem("token"))return;let[a,b]=await Promise.all([k.api.getConversations(),k.api.getProfile()]);if(d(a),q({name:b.name,email:b.email}),a.length)A(a[0]);else{let a=await k.api.sendMessage("Olá, TPF-AI!");d(b=>[a.conversation,...b]),A(a.conversation)}}catch(a){console.error("Erro ao carregar chat:",a.message)}})()},[]),(0,c.useEffect)(()=>{z.current&&(z.current.scrollTop=z.current.scrollHeight)},[i]);let A=async a=>{h(a),y(null);try{let b=await k.api.getConversationHistory(a._id||a.id);j(b||[])}catch{j([])}},B=async(a,b)=>{if(!a||!b)return alert("Título obrigatório");try{await k.api.renameConversation(a,b),d(c=>c.map(c=>c._id===a?{...c,title:b}:c)),D()}catch(a){alert("Erro ao renomear: "+a.message)}},C=async b=>{if(!b)return alert("ID da conversa não encontrado");try{await k.api.deleteConversation(b);let c=a.filter(a=>a._id!==b);d(c),e&&e._id===b&&A(c[0]||null),D()}catch(a){alert("Erro ao excluir: "+a.message)}},D=()=>s(null);return(0,b.jsxs)("div",{className:"chat-container",children:[(0,b.jsxs)("aside",{className:"sidebar",children:[(0,b.jsxs)("h1",{className:"logo",children:["TPF",(0,b.jsx)("span",{children:"-AI"})]}),(0,b.jsx)("button",{className:"new-chat",onClick:async()=>{try{let a=await k.api.sendMessage("Novo chat iniciado!");d(b=>[a.conversation,...b]),A(a.conversation)}catch(a){console.error("Erro ao criar novo chat:",a.message)}},children:"+ Novo Chat"}),(0,b.jsx)("h4",{children:"Histórico"}),(0,b.jsx)("div",{className:"chat-list",children:a.map(a=>(0,b.jsx)(f,{conversation:a,onRename:a=>s({type:"renomear",chat:a}),onDelete:a=>s({type:"excluir",chat:a}),onSelect:A,isActive:e?._id===a._id},a._id))}),(0,b.jsxs)("div",{className:"user-profile",onClick:()=>u(!t),children:[(0,b.jsx)("div",{className:"user-icon-container",children:(0,b.jsx)(o,{size:32,color:"#000000ff"})}),(0,b.jsx)("span",{children:p.name}),t&&(0,b.jsx)(m,{onLogout:()=>window.location.href="/auth/login",userEmail:p.email})]})]}),(0,b.jsxs)("main",{className:"chat-main",children:[(0,b.jsx)("div",{className:"chat-messages",ref:z,children:i.map(a=>(0,b.jsxs)("div",{className:`message-bubble ${"user"===a.role?"user":"bot"}`,children:[a.content,a.generated_document_id&&(0,b.jsx)(DocumentLink,{documentId:a.generated_document_id})]},a._id||a.id))}),(0,b.jsx)(n,{activeConversation:e,onMessageSent:a=>j(b=>[...b,a]),onOpenAddFileModal:()=>w(!0),attachedDocumentId:x,setAttachedDocumentId:y})]}),r&&r.chat&&(0,b.jsx)(g,{type:r.type,chatTitle:r.chat.title,onClose:D,onConfirm:"renomear"===r.type?a=>B(r.chat._id,a):()=>C(r.chat._id)}),v&&(0,b.jsx)(l,{onClose:()=>w(!1),activeConversation:e,onFileUploaded:a=>{y(a),w(!1),alert(`Documento anexado! Digite sua instru\xe7\xe3o e envie.`)}})]})}}];

//# sourceMappingURL=src_app_chat_page_0f2b3786.js.map