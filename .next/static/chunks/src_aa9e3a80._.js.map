{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/agente-ia-tpf/src/components/SidebarItem.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { FiEdit, FiTrash2 } from \"react-icons/fi\";\nimport \"../style/side-bar-Item.css\";\n\nexport default function SidebarItem({\n  conversation,\n  onRename,\n  onDelete,\n  onSelect,\n  isActive,\n}) {\n  const [showMenu, setShowMenu] = useState(false);\n  const [position, setPosition] = useState({ top: 0, left: 0 });\n  const buttonRef = useRef(null); // referência do botão \"⋮\"\n  const menuRef = useRef(null); // referência do dropdown (portal)\n\n  const openMenu = (e) => {\n    e.stopPropagation();\n    if (buttonRef.current) {\n      const rect = buttonRef.current.getBoundingClientRect();\n      setPosition({\n        top: rect.top + window.scrollY,   // posição no documento\n        left: rect.right + 12,            // à direita da sidebar\n      });\n    }\n    setShowMenu(true);\n  };\n\n  const closeMenu = () => setShowMenu(false);\n\n  const toggleMenu = (e) => {\n    e.stopPropagation();\n    if (showMenu) closeMenu();\n    else openMenu(e);\n  };\n\n  const handleRename = (e) => {\n    e.stopPropagation();\n    // opcional: console.log para debug\n    // console.log(\"clicou renomear\", conversation);\n    onRename?.(conversation);\n    closeMenu();\n  };\n\n  const handleDelete = (e) => {\n    e.stopPropagation();\n    // console.log(\"clicou excluir\", conversation);\n    onDelete?.(conversation);\n    closeMenu();\n  };\n\n  // Fecha ao clicar fora OU tocar (considera menuRef + buttonRef)\n  useEffect(() => {\n    const handleClickOutside = (e) => {\n      const target = e.target;\n      // se não está nem no botão nem no menu, fechar\n      if (\n        buttonRef.current &&\n        !buttonRef.current.contains(target) &&\n        menuRef.current &&\n        !menuRef.current.contains(target)\n      ) {\n        setShowMenu(false);\n      }\n    };\n\n    const handleEscape = (e) => {\n      if (e.key === \"Escape\") setShowMenu(false);\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    document.addEventListener(\"touchstart\", handleClickOutside);\n    document.addEventListener(\"keydown\", handleEscape);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n      document.removeEventListener(\"touchstart\", handleClickOutside);\n      document.removeEventListener(\"keydown\", handleEscape);\n    };\n  }, []);\n\n  // Atualiza posição se a janela rolar ou redimensionar enquanto o menu está aberto\n  useEffect(() => {\n    if (!showMenu) return;\n    const updatePos = () => {\n      if (!buttonRef.current) return;\n      const rect = buttonRef.current.getBoundingClientRect();\n      setPosition({\n        top: rect.top + window.scrollY,\n        left: rect.right + 12,\n      });\n    };\n    window.addEventListener(\"scroll\", updatePos, { passive: true });\n    window.addEventListener(\"resize\", updatePos);\n    return () => {\n      window.removeEventListener(\"scroll\", updatePos);\n      window.removeEventListener(\"resize\", updatePos);\n    };\n  }, [showMenu]);\n\n  return (\n    <>\n      <div\n        className={`sidebar-item ${isActive ? \"active\" : \"\"}`}\n        onClick={() => onSelect?.(conversation)}\n      >\n        <span className=\"sidebar-text\">\n          {conversation.title || \"Chat sem nome\"}\n        </span>\n\n        {/* botão que abre o menu */}\n        <div\n          className=\"dots-menu\"\n          ref={buttonRef}\n          onClick={toggleMenu}\n          role=\"button\"\n          aria-haspopup=\"menu\"\n          aria-expanded={showMenu}\n        >\n          <span className=\"dots\">⋮</span>\n        </div>\n      </div>\n\n      {/* portal do dropdown - menuRef permite detectar cliques dentro dele */}\n      {showMenu &&\n        createPortal(\n          <div\n            className=\"floating-dropdown\"\n            ref={menuRef}\n            style={{\n              position: \"absolute\",\n              top: `${position.top}px`,\n              left: `${position.left}px`,\n              zIndex: 99999,\n            }}\n            role=\"menu\"\n          >\n            <p\n              onClick={handleRename}\n              role=\"menuitem\"\n              tabIndex={0}\n              onKeyDown={(e) =>\n                (e.key === \"Enter\" || e.key === \" \") && handleRename(e)\n              }\n            >\n              <FiEdit className=\"icon\" /> Renomear\n            </p>\n            <p\n              onClick={handleDelete}\n              role=\"menuitem\"\n              tabIndex={0}\n              onKeyDown={(e) =>\n                (e.key === \"Enter\" || e.key === \" \") && handleDelete(e)\n              }\n            >\n              <FiTrash2 className=\"icon\" /> Excluir\n            </p>\n          </div>,\n          document.body\n        )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 226, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/agente-ia-tpf/src/components/Modal.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport \"../style/modal.css\";\n\nexport default function Modal({ type, chatTitle, onClose, onConfirm }) {\n  const [newTitle, setNewTitle] = useState(chatTitle || \"\");\n  const inputRef = useRef(null);\n  const isRename = type === \"renomear\";\n  const isDelete = type === \"excluir\";\n\n  useEffect(() => {\n    if (isRename) inputRef.current?.focus();\n\n    const handleEsc = (e) => {\n      if (e.key === \"Escape\") onClose();\n    };\n    document.addEventListener(\"keydown\", handleEsc);\n    return () => document.removeEventListener(\"keydown\", handleEsc);\n  }, [isRename, onClose]);\n\n  const handleConfirm = () => {\n    if (isRename && !newTitle.trim()) return;\n    onConfirm(isRename ? newTitle.trim() : undefined);\n  };\n\n  return (\n    <div className=\"modal-overlay\">\n      <div className=\"modal modal-animate\" role=\"dialog\" aria-modal=\"true\">\n        {isDelete && <p>Deseja realmente excluir o chat \"{chatTitle}\" ? Essa ação é irreversível e as mensagens\n              desse chat serão apagadas</p>}\n        {isRename && (\n          <>\n            <p>Renomear chat:</p>\n            <input\n              ref={inputRef}\n              type=\"text\"\n              value={newTitle}\n              onChange={(e) => setNewTitle(e.target.value)}\n              onKeyPress={(e) => e.key === \"Enter\" && handleConfirm()}\n              maxLength={50}\n            />\n          </>\n        )}\n        <div className=\"modal-actions\">\n          <button className=\"cancelar\" onClick={onClose}>Cancelar</button>\n        <button\n          className=\"confirm\"\n          onClick={() => onConfirm(isRename ? newTitle.trim() : undefined)}\n        >\n          {isDelete ? \"Confirmar Exclusão\" : \"Salvar Novo Nome\"}\n        </button>\n\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;;;;;AAGe,SAAS,MAAM,KAAuC;QAAvC,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,SAAS,EAAE,GAAvC;;IAC5B,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC,aAAa;IACtD,MAAM,WAAW,IAAA,uKAAM,EAAC;IACxB,MAAM,WAAW,SAAS;IAC1B,MAAM,WAAW,SAAS;IAE1B,IAAA,0KAAS;2BAAC;gBACM;YAAd,IAAI,WAAU,oBAAA,SAAS,OAAO,cAAhB,wCAAA,kBAAkB,KAAK;YAErC,MAAM;6CAAY,CAAC;oBACjB,IAAI,EAAE,GAAG,KAAK,UAAU;gBAC1B;;YACA,SAAS,gBAAgB,CAAC,WAAW;YACrC;mCAAO,IAAM,SAAS,mBAAmB,CAAC,WAAW;;QACvD;0BAAG;QAAC;QAAU;KAAQ;IAEtB,MAAM,gBAAgB;QACpB,IAAI,YAAY,CAAC,SAAS,IAAI,IAAI;QAClC,UAAU,WAAW,SAAS,IAAI,KAAK;IACzC;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;YAAsB,MAAK;YAAS,cAAW;;gBAC3D,0BAAY,6LAAC;;wBAAE;wBAAkC;wBAAU;;;;;;;gBAE3D,0BACC;;sCACE,6LAAC;sCAAE;;;;;;sCACH,6LAAC;4BACC,KAAK;4BACL,MAAK;4BACL,OAAO;4BACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;4BAC3C,YAAY,CAAC,IAAM,EAAE,GAAG,KAAK,WAAW;4BACxC,WAAW;;;;;;;;8BAIjB,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAO,WAAU;4BAAW,SAAS;sCAAS;;;;;;sCACjD,6LAAC;4BACC,WAAU;4BACV,SAAS,IAAM,UAAU,WAAW,SAAS,IAAI,KAAK;sCAErD,WAAW,uBAAuB;;;;;;;;;;;;;;;;;;;;;;;AAO7C;GApDwB;KAAA","debugId":null}},
    {"offset": {"line": 356, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/agente-ia-tpf/src/api/Api.js"],"sourcesContent":["const API_BASE_URL = \"https://agente-ia-squad42.onrender.com\";\n\n// Função para pegar token do localStorage. Estava com problemas para autenticar\nconst getToken = () => {\n    const token = localStorage.getItem(\"token\");\n    if (!token) throw new Error(\"Token não encontrado. Faça login novamente.\");\n    return token;\n};\n\n// Função para tratar respostas HTTP\nconst handleResponse = async (res) => {\n    if (!res.ok) {\n        const text = await res.text();\n        throw new Error(`Erro ${res.status}: ${text || res.statusText}`);\n    }\n    try {\n        return res.json();\n    } catch {\n        return null;\n    }\n};\n\n// Função auxiliar para requisições com token\nconst fetchWithToken = async (url, options = {}) => {\n    const token = getToken();\n    const headers = { Authorization: `Bearer ${token}`, ...(options.headers || {}) };\n    const res = await fetch(url, { ...options, headers });\n    return handleResponse(res);\n};\n\n\n\nexport const api = {\n\n\n    /** Login */\n    login: async (email, password) => {\n        if (!email || !password) throw new Error(\"Email e senha são obrigatórios.\");\n        const res = await fetch(`${API_BASE_URL}/api/auth/login`, {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({ email, password }),\n        });\n        const data = await handleResponse(res);\n\n        if (data.access_token) {\n            localStorage.setItem(\"token\", data.access_token);\n        } else {\n            throw new Error(\"Token não retornado pelo servidor.\");\n        }\n\n        return data;\n    },\n\n    /** Registro */\n    register: async (name, email, password) => {\n        if (!name || !email || !password) {\n            throw new Error(\"Nome completo, email e senha são obrigatórios.\");\n        }\n\n        const res = await fetch(`${API_BASE_URL}/api/auth/register`, {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({ name, email, password }),\n        });\n\n        return handleResponse(res);\n    },\n\n    /** Logout */\n    logout: () => {\n        localStorage.removeItem(\"token\");\n        window.location.href = \"/auth/login\";\n    },\n    /*informações do user*/\n    getProfile: async () => {\n        return fetchWithToken(`${API_BASE_URL}/api/auth/profile`);\n    },\n\n\n    /** rota das conversas*/\n\n\n    getConversations: async () => {\n        return fetchWithToken(`${API_BASE_URL}/api/chat/conversations`);\n    },\n\n    getConversationHistory: async (conversationId) => {\n        if (!conversationId) throw new Error(\"ID da conversa é obrigatório.\");\n        return fetchWithToken(`${API_BASE_URL}/api/chat/conversations/${conversationId}`);\n    },\n\n    renameConversation: async (conversationId, newTitle) => {\n        if (!conversationId || !newTitle) throw new Error(\"ID e título são obrigatórios\");\n\n        const url = `${API_BASE_URL}/api/chat/conversations/${conversationId}/rename`;\n\n        return fetchWithToken(url, {\n            method: \"PUT\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({ new_title: newTitle }),\n        });\n    },\n\n    deleteConversation: async (conversationId) => {\n        if (!conversationId) throw new Error(\"ID da conversa obrigatório\");\n        return fetchWithToken(`${API_BASE_URL}/api/chat/conversations/${conversationId}`, {\n            method: \"DELETE\",\n        });\n    },\n\n    /** Fiz uma logica para enviar a mensagem o documento*/\n\n    sendMessage: async (\n        prompt,\n        conversationId = null,\n        attachedDocumentId = null\n    ) => {\n        if (!prompt) throw new Error(\"Mensagem não pode ser vazia.\");\n        const url = `${API_BASE_URL}/api/chat/conversations`;\n\n        const requestBody = {\n            prompt: prompt,\n        };\n        if (conversationId) {\n            requestBody.conversation_id = conversationId;\n        }\n        if (attachedDocumentId) {\n            requestBody.input_document_id = attachedDocumentId;\n        }\n        const data = await fetchWithToken(url, {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify(requestBody),\n        });\n\n        return data;\n    },\n\n    /** rotas dos documentos */\n    uploadDocument: async (file) => {\n        if (!file) throw new Error(\"Arquivo não selecionado.\");\n        const formData = new FormData();\n        formData.append(\"file\", file);\n        return fetchWithToken(`${API_BASE_URL}/api/documents/upload`, {\n            method: \"POST\",\n            body: formData,\n        });\n    },\n\n\n    /**\n   * Baixa um arquivo do backend pelo GridFS File ID.\n   * @param {string} gridfsFileId - ID do arquivo no GridFS.\n   * @returns {Promise<{blob: Blob, filename: string}>} Blob e nome do arquivo original.\n   */\ngetDocumentFile: async (gridfsFileId) => {\n    if (!gridfsFileId) throw new Error(\"ID do arquivo é obrigatório.\");\n\n    const token = getToken();\n\n    const res = await fetch(`${API_BASE_URL}/api/files/${gridfsFileId}`, {\n      headers: { Authorization: `Bearer ${token}` },\n    });\n\n    if (!res.ok) {\n      const status = res.status;\n      const errorText = await res.text();\n      throw new Error(`Falha ao baixar arquivo. Erro HTTP: ${status} - ${errorText}`);\n    }\n\n    // Extrai o filename do header 'Content-Disposition' retornado pelo backend\n    const disposition = res.headers.get(\"Content-Disposition\");\n    let filename = `documento_${gridfsFileId}.docx`; // fallback\n\n    if (disposition && disposition.includes(\"filename=\")) {\n      const match = disposition.match(/filename=\"?(.+?)\"?$/);\n      if (match.length > 1) filename = match[1];\n    }\n\n    const blob = await res.blob();\n\n    return { blob, filename };\n  },\n\n};"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 533, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/agente-ia-tpf/src/components/DocumentLink.js"],"sourcesContent":["import React from \"react\";\nimport { api } from \"../api/Api\";\n\nexport default function DocumentLink({ documentId }) {\n  const handleDownload = async () => {\n    try {\n      const { blob, filename } = await api.getDocumentFile(documentId);\n\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = filename;\n\n      document.body.appendChild(a);\n      a.click();\n\n      a.remove();\n      window.URL.revokeObjectURL(url);\n    } catch (err) {\n      console.error(\"Erro ao baixar arquivo:\", err);\n      alert(\"Erro ao tentar baixar o arquivo. Tente novamente.\");\n    }\n  };\n\n  return (\n    <button\n      onClick={handleDownload}\n      className=\"document-download-btn\"\n      style={{\n        background: \"none\",\n        border: \"none\",\n        color: \"#007bff\",\n        cursor: \"pointer\",\n        textDecoration: \"underline\",\n        marginTop: \"8px\",\n      }}\n    >\n      📄 Baixar documento\n    </button>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAEe,SAAS,aAAa,KAAc;QAAd,EAAE,UAAU,EAAE,GAAd;IACnC,MAAM,iBAAiB;QACrB,IAAI;YACF,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,MAAM,2HAAG,CAAC,eAAe,CAAC;YAErD,MAAM,MAAM,OAAO,GAAG,CAAC,eAAe,CAAC;YACvC,MAAM,IAAI,SAAS,aAAa,CAAC;YACjC,EAAE,IAAI,GAAG;YACT,EAAE,QAAQ,GAAG;YAEb,SAAS,IAAI,CAAC,WAAW,CAAC;YAC1B,EAAE,KAAK;YAEP,EAAE,MAAM;YACR,OAAO,GAAG,CAAC,eAAe,CAAC;QAC7B,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,2BAA2B;YACzC,MAAM;QACR;IACF;IAEA,qBACE,6LAAC;QACC,SAAS;QACT,WAAU;QACV,OAAO;YACL,YAAY;YACZ,QAAQ;YACR,OAAO;YACP,QAAQ;YACR,gBAAgB;YAChB,WAAW;QACb;kBACD;;;;;;AAIL;KArCwB","debugId":null}},
    {"offset": {"line": 589, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/agente-ia-tpf/src/components/AddFileModal.js"],"sourcesContent":["import React, { useState } from \"react\";\nimport { MdOutlineClose, MdDriveFolderUpload, MdDescription } from \"react-icons/md\";\nimport { api } from \"../api/Api\";\nimport \"../style/add-file.css\";\n\nexport default function AddFileModal({ onFileUploaded, onClose, activeConversation }) {\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [uploadedFile, setUploadedFile] = useState(null);\n\n  const handleFileUpload = async (file) => {\n    if (!file || !activeConversation) {\n      setError(\"Selecione um arquivo e verifique a conversa ativa.\");\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const data = await api.uploadDocument(file);\n      const documentId = data?.document?._id || data?._id;\n\n      if (!documentId) {\n        throw new Error(\"ID do documento não recebido da API.\");\n      }\n\n      setUploadedFile({\n        id: documentId,\n        name: file.name,\n        file: file,\n      });\n\n      // Chama a função de callback com o ID e nome do arquivo\n      if (onFileUploaded) {\n        onFileUploaded(documentId, file.name);\n      }\n\n      onClose();\n    } catch (err) {\n      console.error(\"Erro no upload do arquivo:\", err);\n      setError(err.message || \"Erro ao enviar arquivo.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleFileChange = (e) => {\n    const file = e.target.files[0];\n    if (file) {\n      handleFileUpload(file);\n    }\n  };\n\n  return (\n    <div className=\"modal-overlay\">\n      <div className=\"modal add-file-modal modal-animate\">\n        <div className=\"modal-header\">\n          <h3>Enviar Arquivo</h3>\n          <button className=\"close-modal-btn\" onClick={onClose}>\n            <MdOutlineClose />\n          </button>\n        </div>\n\n        <div className=\"modal-content\">\n          {error && <p className=\"error-message\">{error}</p>}\n\n          {!uploadedFile ? (\n            <div className=\"upload-section\">\n              <p className=\"modal-description\">\n                Faça upload do arquivo que você deseja enviar (DOC, DOCX, XLSX, etc.)\n              </p>\n\n              <label className={`file-upload-label ${isLoading ? \"disabled\" : \"\"}`}>\n                <MdDriveFolderUpload className=\"upload-icon\" />\n                <span>{isLoading ? \"Enviando...\" : \"Escolher Arquivo\"}</span>\n                <input\n                  type=\"file\"\n                  onChange={handleFileChange}\n                  disabled={isLoading}\n                  style={{ display: \"none\" }}\n                  accept=\".doc,.docx,.xlsx,.xls,.pdf,.txt\"\n                />\n              </label>\n\n              <div className=\"supported-formats\">\n                <small>Formatos suportados: DOC, DOCX, XLSX, XLS, PDF, TXT</small>\n                <p>Prompt para melhor resposta : Use o “TEMPLATE_TPF.docx” e preencha cada campo com informações completas e detalhadas.</p>\n              </div>\n            </div>\n          ) : (\n            <div className=\"uploaded-file-info\">\n              <MdDescription className=\"file-icon\" />\n              <div className=\"file-details\">\n                <span className=\"file-name\">{uploadedFile.name}</span>\n                <span className=\"file-status\">✓ Arquivo enviado com sucesso</span>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;;;AAGe,SAAS,aAAa,KAA+C;QAA/C,EAAE,cAAc,EAAE,OAAO,EAAE,kBAAkB,EAAE,GAA/C;;IACnC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;IAEjD,MAAM,mBAAmB,OAAO;QAC9B,IAAI,CAAC,QAAQ,CAAC,oBAAoB;YAChC,SAAS;YACT;QACF;QAEA,aAAa;QACb,SAAS;QAET,IAAI;gBAEiB;YADnB,MAAM,OAAO,MAAM,2HAAG,CAAC,cAAc,CAAC;YACtC,MAAM,aAAa,CAAA,iBAAA,4BAAA,iBAAA,KAAM,QAAQ,cAAd,qCAAA,eAAgB,GAAG,MAAI,iBAAA,2BAAA,KAAM,GAAG;YAEnD,IAAI,CAAC,YAAY;gBACf,MAAM,IAAI,MAAM;YAClB;YAEA,gBAAgB;gBACd,IAAI;gBACJ,MAAM,KAAK,IAAI;gBACf,MAAM;YACR;YAEA,wDAAwD;YACxD,IAAI,gBAAgB;gBAClB,eAAe,YAAY,KAAK,IAAI;YACtC;YAEA;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,SAAS,IAAI,OAAO,IAAI;QAC1B,SAAU;YACR,aAAa;QACf;IACF;IAEA,MAAM,mBAAmB,CAAC;QACxB,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,CAAC,EAAE;QAC9B,IAAI,MAAM;YACR,iBAAiB;QACnB;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;sCAAG;;;;;;sCACJ,6LAAC;4BAAO,WAAU;4BAAkB,SAAS;sCAC3C,cAAA,6LAAC,mKAAc;;;;;;;;;;;;;;;;8BAInB,6LAAC;oBAAI,WAAU;;wBACZ,uBAAS,6LAAC;4BAAE,WAAU;sCAAiB;;;;;;wBAEvC,CAAC,6BACA,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAE,WAAU;8CAAoB;;;;;;8CAIjC,6LAAC;oCAAM,WAAW,AAAC,qBAAgD,OAA5B,YAAY,aAAa;;sDAC9D,6LAAC,wKAAmB;4CAAC,WAAU;;;;;;sDAC/B,6LAAC;sDAAM,YAAY,gBAAgB;;;;;;sDACnC,6LAAC;4CACC,MAAK;4CACL,UAAU;4CACV,UAAU;4CACV,OAAO;gDAAE,SAAS;4CAAO;4CACzB,QAAO;;;;;;;;;;;;8CAIX,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;sDAAM;;;;;;sDACP,6LAAC;sDAAE;;;;;;;;;;;;;;;;;iDAIP,6LAAC;4BAAI,WAAU;;8CACb,6LAAC,kKAAa;oCAAC,WAAU;;;;;;8CACzB,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAK,WAAU;sDAAa,aAAa,IAAI;;;;;;sDAC9C,6LAAC;4CAAK,WAAU;sDAAc;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ9C;GAlGwB;KAAA","debugId":null}},
    {"offset": {"line": 836, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/agente-ia-tpf/src/components/MenuPerfil.js"],"sourcesContent":["import React from \"react\";\nimport \"../style/menu-perfil.css\";\n\nexport default function MenuPerfil({ onLogout, userEmail }) {\n  const handleLogout = () => {\n    if (typeof onLogout === \"function\") onLogout();\n  };\n\n  return (\n    <div className=\"profile-menu\">\n      <div className=\"profile-info\">\n        <span>{userEmail}</span>\n      </div>\n      <button className=\"profile-option\" onClick={handleLogout} type=\"button\">\n        <span>Sair</span>\n      </button>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;;;;AAGe,SAAS,WAAW,KAAuB;QAAvB,EAAE,QAAQ,EAAE,SAAS,EAAE,GAAvB;IACjC,MAAM,eAAe;QACnB,IAAI,OAAO,aAAa,YAAY;IACtC;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;8BAAM;;;;;;;;;;;0BAET,6LAAC;gBAAO,WAAU;gBAAiB,SAAS;gBAAc,MAAK;0BAC7D,cAAA,6LAAC;8BAAK;;;;;;;;;;;;;;;;;AAId;KAfwB","debugId":null}},
    {"offset": {"line": 900, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/agente-ia-tpf/src/components/File.js"],"sourcesContent":["// components/FileAttachment.js\nimport React from \"react\";\nimport { MdClose, MdDescription } from \"react-icons/md\";\nimport \"../style/file.css\";\n\nexport default function FileAttachment({ \n  documentId, \n  fileName, \n  onRemove,\n  showRemove = true \n}) {\n  const handleRemove = (e) => {\n    e.stopPropagation();\n    onRemove?.();\n  };\n\n  return (\n    <div className=\"file\">\n      <div className=\"file-info\">\n        <MdDescription className=\"file-icon\" />\n        <span className=\"file-name\" title={fileName}>\n          {fileName || `Documento ${documentId?.substring(0, 8)}`}\n        </span>\n      </div>\n      \n      {showRemove && (\n        <button \n          className=\"remove-file-btn\"\n          onClick={handleRemove}\n          title=\"Remover arquivo\"\n        >\n          <MdClose />\n        </button>\n      )}\n    </div>\n  );\n}"],"names":[],"mappings":"AAAA,+BAA+B;;;;;;AAC/B;AACA;;;;;AAGe,SAAS,eAAe,KAKtC;QALsC,EACrC,UAAU,EACV,QAAQ,EACR,QAAQ,EACR,aAAa,IAAI,EAClB,GALsC;IAMrC,MAAM,eAAe,CAAC;QACpB,EAAE,eAAe;QACjB,qBAAA,+BAAA;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,kKAAa;wBAAC,WAAU;;;;;;kCACzB,6LAAC;wBAAK,WAAU;wBAAY,OAAO;kCAChC,YAAY,AAAC,aAAwC,OAA5B,uBAAA,iCAAA,WAAY,SAAS,CAAC,GAAG;;;;;;;;;;;;YAItD,4BACC,6LAAC;gBACC,WAAU;gBACV,SAAS;gBACT,OAAM;0BAEN,cAAA,6LAAC,4JAAO;;;;;;;;;;;;;;;;AAKlB;KA/BwB","debugId":null}},
    {"offset": {"line": 977, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/agente-ia-tpf/src/components/InputChat.js"],"sourcesContent":["// Aqui onde funciona boa parte da lógica: enviar a mensagem e o arquivo\nimport React, { useState } from \"react\";\nimport { FiSend, FiPlus } from \"react-icons/fi\";\nimport { api } from \"../api/Api\";\nimport File from \"../components/File\";\nimport \"../style/chat.css\";\n\nexport default function InputChat({\n  activeConversation,\n  onOpenAddFileModal,\n  onMessageSent,\n  attachedDocumentId,\n  setAttachedDocumentId,\n  attachedFileName,\n  setAttachedFileName\n}) {\n  const [message, setMessage] = useState(\"\");\n  const [isSending, setIsSending] = useState(false);\n\n  const sendMessage = async () => {\n    const userPrompt = message.trim();\n    if (!activeConversation || (!userPrompt && !attachedDocumentId) || isSending) return;\n\n    setIsSending(true);\n\n    try {\n      // Enviar mensagem do usuário\n      onMessageSent?.({\n        sender: \"user\",\n        content: userPrompt || \"Processar arquivo\",\n        id: crypto.randomUUID(),\n        attachedDocumentId,\n        attachedFileName\n      });\n\n      const conversationId = activeConversation?._id || activeConversation?.id;\n\n      // Enviar para API\n      const data = await api.sendMessage(\n        userPrompt || \"Processar este arquivo\",\n        conversationId,\n        attachedDocumentId\n      );\n\n      // Limpar anexos após envio\n      setAttachedDocumentId(null);\n      setAttachedFileName(null);\n\n      // Mensagem de resposta do bot\n      onMessageSent?.({\n        sender: \"bot\",\n        content:\n          data?.message_content ||\n          data?.content ||\n          \"Tudo pronto! Clique na conversa no histórico à esquerda para ver a resposta completa.\",\n        id: crypto.randomUUID(),\n        generated_document_id: data?.document_id\n      });\n    } catch (err) {\n      console.error(\"Erro ao enviar mensagem:\", err);\n      onMessageSent?.({\n        sender: \"bot\",\n        content: \"Erro de conexão ou servidor. Tente novamente.\",\n        id: crypto.randomUUID()\n      });\n    } finally {\n      setIsSending(false);\n      setMessage(\"\");\n    }\n  };\n\n  const handleRemoveAttachment = () => {\n    setAttachedDocumentId(null);\n    setAttachedFileName(null);\n  };\n\n  const handleKeyDown = (e) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      sendMessage();\n    }\n  };\n\n  const getPlaceholderText = () => {\n    if (attachedDocumentId) return \"Digite suas instruções para o documento...\";\n    if (isSending) return \"Aguardando resposta...\";\n    return \"Digite sua mensagem...\";\n  };\n\n  return (\n    <div className=\"chat-input-container\">\n      {/* Área de anexo */}\n      {attachedDocumentId && (\n        <div className=\"attachment-preview\">\n          <File\n            documentId={attachedDocumentId}\n            fileName={attachedFileName}\n            onRemove={handleRemoveAttachment}\n          />\n        </div>\n      )}\n\n      {/* Área de input */}\n      <div className={`chat-input ${attachedDocumentId ? \"has-attachment\" : \"\"}`}>\n        <button\n          className=\"add-file-btn\"\n          onClick={onOpenAddFileModal}\n          disabled={isSending}\n          title=\"Anexar arquivo\"\n        >\n          <FiPlus className={attachedDocumentId ? \"attached-icon\" : \"\"} />\n        </button>\n\n        <input\n          type=\"text\"\n          placeholder={getPlaceholderText()}\n          value={message}\n          onChange={(e) => setMessage(e.target.value)}\n          onKeyDown={handleKeyDown}\n          disabled={isSending}\n        />\n\n        <button\n          className=\"send-btn\"\n          onClick={sendMessage}\n          disabled={isSending || (!message.trim() && !attachedDocumentId)}\n          title=\"Enviar mensagem\"\n        >\n          <FiSend />\n        </button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"AAAA,wEAAwE;;;;;;AACxE;AACA;AACA;AACA;;;;;;;;AAGe,SAAS,UAAU,KAQjC;QARiC,EAChC,kBAAkB,EAClB,kBAAkB,EAClB,aAAa,EACb,kBAAkB,EAClB,qBAAqB,EACrB,gBAAgB,EAChB,mBAAmB,EACpB,GARiC;;IAShC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAE3C,MAAM,cAAc;QAClB,MAAM,aAAa,QAAQ,IAAI;QAC/B,IAAI,CAAC,sBAAuB,CAAC,cAAc,CAAC,sBAAuB,WAAW;QAE9E,aAAa;QAEb,IAAI;YACF,6BAA6B;YAC7B,0BAAA,oCAAA,cAAgB;gBACd,QAAQ;gBACR,SAAS,cAAc;gBACvB,IAAI,OAAO,UAAU;gBACrB;gBACA;YACF;YAEA,MAAM,iBAAiB,CAAA,+BAAA,yCAAA,mBAAoB,GAAG,MAAI,+BAAA,yCAAA,mBAAoB,EAAE;YAExE,kBAAkB;YAClB,MAAM,OAAO,MAAM,2HAAG,CAAC,WAAW,CAChC,cAAc,0BACd,gBACA;YAGF,2BAA2B;YAC3B,sBAAsB;YACtB,oBAAoB;YAEpB,8BAA8B;YAC9B,0BAAA,oCAAA,cAAgB;gBACd,QAAQ;gBACR,SACE,CAAA,iBAAA,2BAAA,KAAM,eAAe,MACrB,iBAAA,2BAAA,KAAM,OAAO,KACb;gBACF,IAAI,OAAO,UAAU;gBACrB,qBAAqB,EAAE,iBAAA,2BAAA,KAAM,WAAW;YAC1C;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,4BAA4B;YAC1C,0BAAA,oCAAA,cAAgB;gBACd,QAAQ;gBACR,SAAS;gBACT,IAAI,OAAO,UAAU;YACvB;QACF,SAAU;YACR,aAAa;YACb,WAAW;QACb;IACF;IAEA,MAAM,yBAAyB;QAC7B,sBAAsB;QACtB,oBAAoB;IACtB;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,WAAW,CAAC,EAAE,QAAQ,EAAE;YACpC,EAAE,cAAc;YAChB;QACF;IACF;IAEA,MAAM,qBAAqB;QACzB,IAAI,oBAAoB,OAAO;QAC/B,IAAI,WAAW,OAAO;QACtB,OAAO;IACT;IAEA,qBACE,6LAAC;QAAI,WAAU;;YAEZ,oCACC,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC,uIAAI;oBACH,YAAY;oBACZ,UAAU;oBACV,UAAU;;;;;;;;;;;0BAMhB,6LAAC;gBAAI,WAAW,AAAC,cAAwD,OAA3C,qBAAqB,mBAAmB;;kCACpE,6LAAC;wBACC,WAAU;wBACV,SAAS;wBACT,UAAU;wBACV,OAAM;kCAEN,cAAA,6LAAC,2JAAM;4BAAC,WAAW,qBAAqB,kBAAkB;;;;;;;;;;;kCAG5D,6LAAC;wBACC,MAAK;wBACL,aAAa;wBACb,OAAO;wBACP,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK;wBAC1C,WAAW;wBACX,UAAU;;;;;;kCAGZ,6LAAC;wBACC,WAAU;wBACV,SAAS;wBACT,UAAU,aAAc,CAAC,QAAQ,IAAI,MAAM,CAAC;wBAC5C,OAAM;kCAEN,cAAA,6LAAC,2JAAM;;;;;;;;;;;;;;;;;;;;;;AAKjB;GA9HwB;KAAA","debugId":null}},
    {"offset": {"line": 1142, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/agente-ia-tpf/src/app/chat/page.js"],"sourcesContent":["\"use client\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport SidebarItem from \"../../components/SidebarItem\";\nimport Modal from \"../../components/Modal\";\nimport DocumentLink from \"../../components/DocumentLink\";\nimport AddFileModal from \"../../components/AddFileModal\";\nimport MenuPerfil from \"../../components/MenuPerfil\";\nimport InputChat from \"../../components/InputChat\";\nimport { FaUserCircle } from \"react-icons/fa\";\nimport { api } from \"../../api/Api\";\nimport \"../../style/chat.css\";\n\nexport default function ChatPage() {\n  const [conversations, setConversations] = useState([]);\n  const [activeConversation, setActiveConversation] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [user, setUser] = useState({\n    name: \"Carregando...\",\n    email: \"carregando@email.com\",\n  });\n  const [modal, setModal] = useState(null);\n  const [showMenuPerfil, setShowMenuPerfil] = useState(false);\n  const [showAddFileModal, setShowAddFileModal] = useState(false);\n\n  // Estados para gerenciar os anexos\n  const [attachedDocumentId, setAttachedDocumentId] = useState(null);\n  const [attachedFileName, setAttachedFileName] = useState(null);\n\n  const chatContainerRef = useRef(null);\n\n  // Carrega conversas e usuário ao abrir\n  useEffect(() => {\n    const load = async () => {\n      try {\n        const token = localStorage.getItem(\"token\");\n        if (!token) return;\n\n        const [convData, userData] = await Promise.all([\n          api.getConversations(),\n          api.getProfile(),\n        ]);\n\n        setConversations(convData);\n        setUser({ name: userData.name, email: userData.email });\n\n        if (convData.length) selectConversation(convData[0]);\n        else {\n          const newConvData = await api.sendMessage(\"Olá, TPF-AI!\");\n          setConversations((prev) => [newConvData.conversation, ...prev]);\n          selectConversation(newConvData.conversation);\n        }\n      } catch (err) {\n        console.error(\"Erro ao carregar chat:\", err.message);\n      }\n    };\n    load();\n  }, []);\n\n  useEffect(() => {\n    if (chatContainerRef.current)\n      chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\n  }, [messages]);\n\n  // Função para selecionar uma conversa\n  const selectConversation = async (conversation) => {\n    setActiveConversation(conversation);\n    setAttachedDocumentId(null);\n    setAttachedFileName(null);\n    try {\n      const history = await api.getConversationHistory(conversation._id || conversation.id);\n      setMessages(history || []);\n    } catch {\n      setMessages([]);\n    }\n  };\n\n  // Funções de renomear e excluir\n  const handleRenameConversation = async (conversationId, newTitle) => {\n    if (!conversationId || !newTitle) return alert(\"Título obrigatório\");\n\n    try {\n      await api.renameConversation(conversationId, newTitle);\n      setConversations((prev) =>\n        prev.map((c) => (c._id === conversationId ? { ...c, title: newTitle } : c))\n      );\n      closeModal();\n    } catch (err) {\n      alert(\"Erro ao renomear: \" + err.message);\n    }\n  };\n\n  const handleDeleteConversation = async (conversationId) => {\n    if (!conversationId) return alert(\"ID da conversa não encontrado\");\n\n    try {\n      await api.deleteConversation(conversationId);\n      const newConversations = conversations.filter((c) => c._id !== conversationId);\n      setConversations(newConversations);\n\n      if (activeConversation && activeConversation._id === conversationId) {\n        selectConversation(newConversations[0] || null);\n      }\n      closeModal();\n    } catch (err) {\n      alert(\"Erro ao excluir: \" + err.message);\n    }\n  };\n\n  const handleNewMessage = (msg) => setMessages((prev) => [...prev, msg]);\n  const closeModal = () => setModal(null);\n  const onLogout = () => (window.location.href = \"/auth/login\");\n\n  const handleFileUploaded = (documentId, fileName) => {\n    setAttachedDocumentId(documentId);\n    setAttachedFileName(fileName);\n    setShowAddFileModal(false);\n    alert(`Arquivo \"${fileName}\" anexado! Digite suas instruções.`);\n  };\n\n  return (\n    <div className=\"chat-container\">\n      {/* Sidebar */}\n      <aside className=\"sidebar\">\n        <h1 className=\"logo\">\n          TPF<span>-AI</span>\n        </h1>\n\n        <button\n          className=\"new-chat\"\n          onClick={async () => {\n            try {\n              setActiveConversation(null);\n              setMessages([]);\n              setAttachedDocumentId(null);\n              setAttachedFileName(null);\n\n              const apiResponse = await api.sendMessage(\"Novo chat iniciado\");\n\n              if (!apiResponse || !apiResponse.conversation_id) {\n                throw new Error(\"API não retornou o ID da nova conversa.\");\n              }\n              const newConvList = await api.getConversations();\n              const newConversation =\n                newConvList.find((c) => c._id === apiResponse.conversation_id) || newConvList[0];\n\n              if (!newConversation) {\n                throw new Error(\"Falha ao recuperar os dados da nova conversa.\");\n              }\n\n              setConversations(newConvList);\n              selectConversation(newConversation);\n            } catch (err) {\n              console.error(\"Erro ao criar novo chat:\", err.message);\n            }\n          }}\n        >\n          + Novo Chat\n        </button>\n\n        <h4>Histórico</h4>\n        <div className=\"chat-list\">\n          {conversations\n            .filter((conv) => conv && conv._id)\n            .map((conv) => (\n              <SidebarItem\n                key={conv._id}\n                conversation={conv}\n                onRename={(conversation) =>\n                  setModal({ type: \"renomear\", chat: conversation })\n                }\n                onDelete={(conversation) =>\n                  setModal({ type: \"excluir\", chat: conversation })\n                }\n                onSelect={selectConversation}\n                isActive={activeConversation && activeConversation._id === conv._id}\n              />\n            ))}\n        </div>\n\n        <div className=\"user-profile\" onClick={() => setShowMenuPerfil(!showMenuPerfil)}>\n          <div className=\"user-icon-container\">\n            <FaUserCircle size={32} color=\"#000000ff\" />\n          </div>\n          <span>{user.name}</span>\n          {showMenuPerfil && <MenuPerfil onLogout={onLogout} userEmail={user.email} />}\n        </div>\n      </aside>\n\n      {/* Chat principal */}\n      <main className=\"chat-main\">\n        <div className=\"chat-messages\" ref={chatContainerRef}>\n          {messages.map((msg) => (\n            <div\n              key={msg._id || msg.id}\n              className={`message-bubble ${\n                msg.role === \"user\" || msg.sender === \"user\" ? \"user\" : \"bot\"\n              }`}\n            >\n              {msg.content}\n             {msg.document_id && <DocumentLink documentId={msg.document_id} />}\n            </div>\n          ))}\n        </div>\n\n        <InputChat\n          activeConversation={activeConversation}\n          onMessageSent={handleNewMessage}\n          onOpenAddFileModal={() => setShowAddFileModal(true)}\n          attachedDocumentId={attachedDocumentId}\n          setAttachedDocumentId={setAttachedDocumentId}\n          attachedFileName={attachedFileName}\n          setAttachedFileName={setAttachedFileName}\n        />\n      </main>\n\n      {/* Modais */}\n      {modal && modal.chat && (\n        <Modal\n          type={modal.type}\n          chatTitle={modal.chat.title}\n          onClose={closeModal}\n          onConfirm={\n            modal.type === \"renomear\"\n              ? (newTitle) => handleRenameConversation(modal.chat._id, newTitle)\n              : () => handleDeleteConversation(modal.chat._id)\n          }\n        />\n      )}\n\n      {showAddFileModal && (\n        <AddFileModal\n          onClose={() => setShowAddFileModal(false)}\n          activeConversation={activeConversation}\n          onFileUploaded={handleFileUploaded}\n        />\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}