(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,37115,e=>{"use strict";e.s(["default",()=>N],37115);var a=e.i(43476),t=e.i(71645),n=e.i(74080),s=e.i(92199);function l(e){let{conversation:l,onRename:i,onDelete:o,onSelect:r,isActive:c}=e,[d,m]=(0,t.useState)(!1),[u,h]=(0,t.useState)({top:0,left:0}),p=(0,t.useRef)(null),v=(0,t.useRef)(null),x=()=>m(!1),f=e=>{e.stopPropagation(),null==i||i(l),x()},j=e=>{e.stopPropagation(),null==o||o(l),x()};return(0,t.useEffect)(()=>{let e=e=>{let a=e.target;p.current&&!p.current.contains(a)&&v.current&&!v.current.contains(a)&&m(!1)},a=e=>{"Escape"===e.key&&m(!1)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),document.addEventListener("keydown",a),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e),document.removeEventListener("keydown",a)}},[]),(0,t.useEffect)(()=>{if(!d)return;let e=()=>{if(!p.current)return;let e=p.current.getBoundingClientRect();h({top:e.top+window.scrollY,left:e.right+12})};return window.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}},[d]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"sidebar-item ".concat(c?"active":""),onClick:()=>null==r?void 0:r(l),children:[(0,a.jsx)("span",{className:"sidebar-text",children:l.title||"Chat sem nome"}),(0,a.jsx)("div",{className:"dots-menu",ref:p,onClick:e=>{if(e.stopPropagation(),d)x();else{if(e.stopPropagation(),p.current){let e=p.current.getBoundingClientRect();h({top:e.top+window.scrollY,left:e.right+12})}m(!0)}},role:"button","aria-haspopup":"menu","aria-expanded":d,children:(0,a.jsx)("span",{className:"dots",children:"⋮"})})]}),d&&(0,n.createPortal)((0,a.jsxs)("div",{className:"floating-dropdown",ref:v,style:{position:"absolute",top:"".concat(u.top,"px"),left:"".concat(u.left,"px"),zIndex:99999},role:"menu",children:[(0,a.jsxs)("p",{onClick:f,role:"menuitem",tabIndex:0,onKeyDown:e=>("Enter"===e.key||" "===e.key)&&f(e),children:[(0,a.jsx)(s.FiEdit,{className:"icon"})," Renomear"]}),(0,a.jsxs)("p",{onClick:j,role:"menuitem",tabIndex:0,onKeyDown:e=>("Enter"===e.key||" "===e.key)&&j(e),children:[(0,a.jsx)(s.FiTrash2,{className:"icon"})," Excluir"]})]}),document.body)]})}function i(e){let{type:n,chatTitle:s,onClose:l,onConfirm:i}=e,[o,r]=(0,t.useState)(s||""),c=(0,t.useRef)(null),d="renomear"===n,m="excluir"===n;return(0,t.useEffect)(()=>{var e;d&&(null==(e=c.current)||e.focus());let a=e=>{"Escape"===e.key&&l()};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[d,l]),(0,a.jsx)("div",{className:"modal-overlay",children:(0,a.jsxs)("div",{className:"modal modal-animate",role:"dialog","aria-modal":"true",children:[m&&(0,a.jsxs)("p",{children:['Deseja realmente excluir o chat "',s,'" ? Essa ação é irreversível e as mensagens desse chat serão apagadas']}),d&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{children:"Renomear chat:"}),(0,a.jsx)("input",{ref:c,type:"text",value:o,onChange:e=>r(e.target.value),onKeyPress:e=>"Enter"===e.key&&void((!d||o.trim())&&i(d?o.trim():void 0)),maxLength:50})]}),(0,a.jsxs)("div",{className:"modal-actions",children:[(0,a.jsx)("button",{className:"cancelar",onClick:l,children:"Cancelar"}),(0,a.jsx)("button",{className:"confirm",onClick:()=>i(d?o.trim():void 0),children:m?"Confirmar Exclusão":"Salvar Novo Nome"})]})]})})}var o=e.i(67789),r=e.i(40141);function c(e){return(0,r.GenIcon)({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"},child:[]}]})(e)}function d(e){return(0,r.GenIcon)({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"},child:[]}]})(e)}function m(e){let{documentId:n}=e,[s,l]=(0,t.useState)(null),[i,r]=(0,t.useState)("Documento Gerado"),[d,m]=(0,t.useState)(!0);return((0,t.useEffect)(()=>{(async()=>{if(n)try{let e=await o.api.getDocumentMetadata(n);l(e.gridfs_file_id),r(e.filename||"Documento Gerado")}catch(e){console.error("Erro ao buscar metadados do arquivo:",e)}finally{m(!1)}})()},[n]),d)?(0,a.jsx)("small",{children:"Carregando link do documento..."}):s?(0,a.jsxs)("a",{href:"".concat(o.api.API_BASE_URL,"/api/files/").concat(s),target:"_blank",rel:"noopener noreferrer",className:"document-download-link",children:[(0,a.jsx)(c,{})," Baixar: ",i]}):(0,a.jsx)("small",{children:"Link de download indisponível."})}function u(e){return(0,r.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"},child:[]}]})(e)}function h(e){return(0,r.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10zM8 13.01l1.41 1.41L11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01z"},child:[]}]})(e)}function p(e){return(0,r.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(e)}function v(e){return(0,r.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"},child:[]}]})(e)}function x(e){let{onFileUploaded:n,onClose:s,activeConversation:l}=e,[i,r]=(0,t.useState)(!1),[c,d]=(0,t.useState)(null),[m,p]=(0,t.useState)([]),[x,f]=(0,t.useState)(null),[j,g]=(0,t.useState)(null),[N,y]=(0,t.useState)(1);(0,t.useEffect)(()=>{2===N&&E()},[N]);let E=async()=>{try{r(!0);let e=await o.api.getTemplates();p(e||[])}catch(e){console.error("Erro ao carregar templates:",e),d("Erro ao carregar templates. Tente novamente.")}finally{r(!1)}},w=async e=>{if(!e||!l)return void d("Selecione um arquivo e verifique a conversa ativa.");r(!0),d(null);try{var a;let t=await o.api.uploadDocument(e),n=(null==t||null==(a=t.document)?void 0:a._id)||(null==t?void 0:t._id);if(!n)throw Error("ID do documento não recebido da API.");f({id:n,name:e.name,file:e}),y(2)}catch(e){console.error("Erro no upload do arquivo:",e),d(e.message||"Erro ao enviar arquivo.")}finally{r(!1)}},C=async e=>{if(x)try{let a={documentId:x.id,templateId:e._id,fileName:x.name,templateName:e.name};console.log("Processando:",a),n&&n(x.id,x.name,e._id),s()}catch(e){console.error("Erro ao processar:",e),d("Erro ao selecionar template.")}};return(0,a.jsx)("div",{className:"modal-overlay",children:(0,a.jsxs)("div",{className:"modal add-file-modal modal-animate",children:[(0,a.jsxs)("div",{className:"modal-header",children:[(0,a.jsx)("h3",{children:1===N?"Enviar Arquivo":"Selecionar Template"}),(0,a.jsx)("button",{className:"close-modal-btn",onClick:s,children:(0,a.jsx)(v,{})})]}),(0,a.jsx)("div",{className:"modal-steps",children:(0,a.jsxs)("div",{className:"step-indicator",children:[(0,a.jsxs)("div",{className:"step ".concat(N>=1?"active":""),children:[(0,a.jsx)("span",{children:"1"}),"Upload"]}),(0,a.jsx)("div",{className:"step-connector"}),(0,a.jsxs)("div",{className:"step ".concat(N>=2?"active":""),children:[(0,a.jsx)("span",{children:"2"}),"Template"]})]})}),(0,a.jsxs)("div",{className:"modal-content",children:[c&&(0,a.jsx)("p",{className:"error-message",children:c}),1===N&&(0,a.jsxs)("div",{className:"upload-section",children:[(0,a.jsx)("p",{className:"modal-description",children:"Faça upload do arquivo que você deseja processar (DOC, DOCX, XLSX, etc.)"}),(0,a.jsxs)("label",{className:"file-upload-label ".concat(i?"disabled":""),children:[(0,a.jsx)(h,{className:"upload-icon"}),(0,a.jsx)("span",{children:i?"Enviando...":"Escolher Arquivo"}),(0,a.jsx)("input",{type:"file",onChange:e=>{let a=e.target.files[0];a&&w(a)},disabled:i,style:{display:"none"},accept:".doc,.docx,.xlsx,.xls,.pdf,.txt"})]}),(0,a.jsx)("div",{className:"supported-formats",children:(0,a.jsx)("small",{children:"Formatos suportados: DOC, DOCX, XLSX, XLS, PDF, TXT"})})]}),2===N&&x&&(0,a.jsxs)("div",{className:"templates-section",children:[(0,a.jsxs)("div",{className:"uploaded-file-info",children:[(0,a.jsx)(u,{className:"file-icon"}),(0,a.jsxs)("div",{className:"file-details",children:[(0,a.jsx)("span",{className:"file-name",children:x.name}),(0,a.jsx)("span",{className:"file-status",children:"✓ Arquivo enviado com sucesso"})]}),(0,a.jsx)("button",{className:"change-file-btn",onClick:()=>{y(1),f(null),g(null),d(null)},children:"Alterar"})]}),(0,a.jsx)("p",{className:"modal-description",children:"Selecione um template para processar o arquivo:"}),i?(0,a.jsx)("div",{className:"loading-templates",children:(0,a.jsx)("p",{children:"Carregando templates..."})}):(0,a.jsxs)("div",{className:"templates-list",children:[m.map(e=>(0,a.jsxs)("div",{className:"template_name ".concat((null==j?void 0:j._id)===e._id?"selected":""),onClick:()=>C(e),children:[(0,a.jsx)(u,{className:"template-icon"}),(0,a.jsxs)("div",{className:"template-info",children:[(0,a.jsx)("span",{className:"template-name",children:e.name}),e.description&&(0,a.jsx)("span",{className:"template-description",children:e.description})]})]},e._id)),0===m.length&&(0,a.jsxs)("div",{className:"no-templates",children:[(0,a.jsx)(u,{className:"no-templates-icon"}),(0,a.jsx)("p",{children:"Nenhum template disponível"}),(0,a.jsx)("small",{children:"Entre em contato com o administrador para adicionar templates."})]})]})]})]})]})})}function f(e){let{onLogout:t,userEmail:n}=e;return(0,a.jsxs)("div",{className:"profile-menu",children:[(0,a.jsx)("div",{className:"profile-info",children:(0,a.jsx)("span",{children:n})}),(0,a.jsx)("button",{className:"profile-option",onClick:()=>{"function"==typeof t&&t()},type:"button",children:(0,a.jsx)("span",{children:"Sair"})})]})}function j(e){let{documentId:t,fileName:n,onRemove:s,showRemove:l=!0}=e;return(0,a.jsxs)("div",{className:"file",children:[(0,a.jsxs)("div",{className:"file-info",children:[(0,a.jsx)(u,{className:"file-icon"}),(0,a.jsx)("span",{className:"file-name",title:n,children:n||"Documento ".concat(null==t?void 0:t.substring(0,8))})]}),l&&(0,a.jsx)("button",{className:"remove-file-btn",onClick:e=>{e.stopPropagation(),null==s||s()},title:"Remover arquivo",children:(0,a.jsx)(p,{})})]})}function g(e){let{activeConversation:n,onOpenAddFileModal:l,onMessageSent:i,attachedDocumentId:r,setAttachedDocumentId:c,attachedFileName:d,setAttachedFileName:m,attachedTemplateId:u,setAttachedTemplateId:h}=e,[p,v]=(0,t.useState)(""),[x,f]=(0,t.useState)(!1),g=async()=>{let e=p.trim();if(n&&(e||r)&&!x){f(!0);try{null==i||i({sender:"user",content:e||"Processar arquivo com template",id:crypto.randomUUID(),attachedDocumentId:r,attachedFileName:d,templateId:u});let a=(null==n?void 0:n._id)||(null==n?void 0:n.id),t=await o.api.sendMessage(e||"Processar este arquivo com o template selecionado",a,r,u);c(null),m(null),h(null),null==i||i({sender:"bot",content:(null==t?void 0:t.message_content)||(null==t?void 0:t.content)||"Tudo pronto! Clique na conversa no histórico à esquerda para ver a resposta completa.",id:crypto.randomUUID(),generated_document_id:null==t?void 0:t.document_id})}catch(e){console.error("Erro ao enviar mensagem:",e),null==i||i({sender:"bot",content:"Erro de conexão ou servidor. Tente novamente.",id:crypto.randomUUID()})}finally{f(!1),v("")}}},N=()=>{c(null),m(null),h(null)};return(0,a.jsxs)("div",{className:"chat-input-container",children:[(r||u)&&(0,a.jsxs)("div",{className:"attachment-preview",children:[r&&(0,a.jsx)(j,{documentId:r,fileName:d,onRemove:N}),u&&(0,a.jsxs)("div",{className:"template-attachment",children:[(0,a.jsxs)("div",{className:"file-info",children:[(0,a.jsx)("span",{className:"file-icon",children:"📄"}),(0,a.jsx)("span",{className:"file-name",children:"Template selecionado"})]}),(0,a.jsx)("button",{className:"remove-file-btn",onClick:r?()=>{h(null)}:N,title:"Remover template",children:"×"})]})]}),(0,a.jsxs)("div",{className:"chat-input ".concat(r||u?"has-attachment":""),children:[(0,a.jsx)("button",{className:"add-file-btn",onClick:l,disabled:x,title:"Anexar arquivo e template",children:(0,a.jsx)(s.FiPlus,{className:r?"attached-icon":""})}),(0,a.jsx)("input",{type:"text",placeholder:r&&u?"Digite instruções para processar o arquivo com o template...":r?"Digite suas instruções para o documento...":x?"Aguardando resposta...":"Digite sua mensagem...",value:p,onChange:e=>v(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),g())},disabled:x}),(0,a.jsx)("button",{className:"send-btn",onClick:g,disabled:x||!p.trim()&&!r,title:"Enviar mensagem",children:(0,a.jsx)(s.FiSend,{})})]})]})}function N(){let[e,n]=(0,t.useState)([]),[s,r]=(0,t.useState)(null),[c,u]=(0,t.useState)([]),[h,p]=(0,t.useState)({name:"Carregando...",email:"carregando@email.com"}),[v,j]=(0,t.useState)(null),[N,y]=(0,t.useState)(!1),[E,w]=(0,t.useState)(!1),[C,b]=(0,t.useState)(null),[S,_]=(0,t.useState)(null),[k,I]=(0,t.useState)(null),D=(0,t.useRef)(null);(0,t.useEffect)(()=>{(async()=>{try{if(!localStorage.getItem("token"))return;let[e,a]=await Promise.all([o.api.getConversations(),o.api.getProfile()]);if(n(e),p({name:a.name,email:a.email}),e.length)L(e[0]);else{let e=await o.api.sendMessage("Olá, TPF-AI!");n(a=>[e.conversation,...a]),L(e.conversation)}}catch(e){console.error("Erro ao carregar chat:",e.message)}})()},[]),(0,t.useEffect)(()=>{D.current&&(D.current.scrollTop=D.current.scrollHeight)},[c]);let L=async e=>{r(e),b(null),_(null),I(null);try{let a=await o.api.getConversationHistory(e._id||e.id);u(a||[])}catch(e){u([])}},z=async(e,a)=>{if(!e||!a)return alert("Título obrigatório");try{await o.api.renameConversation(e,a),n(t=>t.map(t=>t._id===e?{...t,title:a}:t)),T()}catch(e){alert("Erro ao renomear: "+e.message)}},P=async a=>{if(!a)return alert("ID da conversa não encontrado");try{await o.api.deleteConversation(a);let t=e.filter(e=>e._id!==a);n(t),s&&s._id===a&&L(t[0]||null),T()}catch(e){alert("Erro ao excluir: "+e.message)}},T=()=>j(null);return(0,a.jsxs)("div",{className:"chat-container",children:[(0,a.jsxs)("aside",{className:"sidebar",children:[(0,a.jsxs)("h1",{className:"logo",children:["TPF",(0,a.jsx)("span",{children:"-AI"})]}),(0,a.jsx)("button",{className:"new-chat",onClick:async()=>{try{r(null),u([]),b(null),_(null),I(null);let e=await o.api.sendMessage("Novo chat iniciado");if(!e||!e.conversation_id)throw Error("API não retornou o ID da nova conversa.");let a=await o.api.getConversations(),t=a.find(a=>a._id===e.conversation_id)||a[0];if(!t)throw Error("Falha ao recuperar os dados da nova conversa.");n(a),L(t)}catch(e){console.error("Erro ao criar novo chat:",e.message)}},children:"+ Novo Chat"}),(0,a.jsx)("h4",{children:"Histórico"}),(0,a.jsx)("div",{className:"chat-list",children:e.filter(e=>e&&e._id).map(e=>(0,a.jsx)(l,{conversation:e,onRename:e=>j({type:"renomear",chat:e}),onDelete:e=>j({type:"excluir",chat:e}),onSelect:L,isActive:s&&s._id===e._id},e._id))}),(0,a.jsxs)("div",{className:"user-profile",onClick:()=>y(!N),children:[(0,a.jsx)("div",{className:"user-icon-container",children:(0,a.jsx)(d,{size:32,color:"#000000ff"})}),(0,a.jsx)("span",{children:h.name}),N&&(0,a.jsx)(f,{onLogout:()=>window.location.href="/auth/login",userEmail:h.email})]})]}),(0,a.jsxs)("main",{className:"chat-main",children:[(0,a.jsx)("div",{className:"chat-messages",ref:D,children:c.map(e=>(0,a.jsxs)("div",{className:"message-bubble ".concat("user"===e.role||"user"===e.sender?"user":"bot"),children:[e.content,e.document_id&&(0,a.jsx)(m,{documentId:e.document_id})]},e._id||e.id))}),(0,a.jsx)(g,{activeConversation:s,onMessageSent:e=>u(a=>[...a,e]),onOpenAddFileModal:()=>w(!0),attachedDocumentId:C,setAttachedDocumentId:b,attachedFileName:S,setAttachedFileName:_,attachedTemplateId:k,setAttachedTemplateId:I})]}),v&&v.chat&&(0,a.jsx)(i,{type:v.type,chatTitle:v.chat.title,onClose:T,onConfirm:"renomear"===v.type?e=>z(v.chat._id,e):()=>P(v.chat._id)}),E&&(0,a.jsx)(x,{onClose:()=>w(!1),activeConversation:s,onFileUploaded:(e,a,t)=>{b(e),_(a),I(t),w(!1),alert('Arquivo "'.concat(a,'" e template selecionado! Digite suas instruções.'))}})]})}}]);