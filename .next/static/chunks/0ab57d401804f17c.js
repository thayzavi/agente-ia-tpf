(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,37115,e=>{"use strict";e.s(["default",()=>p],37115);var t=e.i(43476),n=e.i(71645),a=e.i(74080),o=e.i(92199);function s(e){let{conversation:s,onRename:r,onDelete:i,onSelect:l,isActive:c}=e,[d,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)({top:0,left:0}),v=(0,n.useRef)(null),p=(0,n.useRef)(null),x=()=>u(!1),f=e=>{e.stopPropagation(),null==r||r(s),x()},g=e=>{e.stopPropagation(),null==i||i(s),x()};return(0,n.useEffect)(()=>{let e=e=>{let t=e.target;v.current&&!v.current.contains(t)&&p.current&&!p.current.contains(t)&&u(!1)},t=e=>{"Escape"===e.key&&u(!1)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e),document.removeEventListener("keydown",t)}},[]),(0,n.useEffect)(()=>{if(!d)return;let e=()=>{if(!v.current)return;let e=v.current.getBoundingClientRect();h({top:e.top+window.scrollY,left:e.right+12})};return window.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}},[d]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"sidebar-item ".concat(c?"active":""),onClick:()=>null==l?void 0:l(s),children:[(0,t.jsx)("span",{className:"sidebar-text",children:s.title||"Chat sem nome"}),(0,t.jsx)("div",{className:"dots-menu",ref:v,onClick:e=>{if(e.stopPropagation(),d)x();else{if(e.stopPropagation(),v.current){let e=v.current.getBoundingClientRect();h({top:e.top+window.scrollY,left:e.right+12})}u(!0)}},role:"button","aria-haspopup":"menu","aria-expanded":d,children:(0,t.jsx)("span",{className:"dots",children:"⋮"})})]}),d&&(0,a.createPortal)((0,t.jsxs)("div",{className:"floating-dropdown",ref:p,style:{position:"absolute",top:"".concat(m.top,"px"),left:"".concat(m.left,"px"),zIndex:99999},role:"menu",children:[(0,t.jsxs)("p",{onClick:f,role:"menuitem",tabIndex:0,onKeyDown:e=>("Enter"===e.key||" "===e.key)&&f(e),children:[(0,t.jsx)(o.FiEdit,{className:"icon"})," Renomear"]}),(0,t.jsxs)("p",{onClick:g,role:"menuitem",tabIndex:0,onKeyDown:e=>("Enter"===e.key||" "===e.key)&&g(e),children:[(0,t.jsx)(o.FiTrash2,{className:"icon"})," Excluir"]})]}),document.body)]})}function r(e){let{type:a,chatTitle:o,onClose:s,onConfirm:r}=e,[i,l]=(0,n.useState)(o||""),c=(0,n.useRef)(null),d="renomear"===a,u="excluir"===a;return(0,n.useEffect)(()=>{var e;d&&(null==(e=c.current)||e.focus());let t=e=>{"Escape"===e.key&&s()};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[d,s]),(0,t.jsx)("div",{className:"modal-overlay",children:(0,t.jsxs)("div",{className:"modal modal-animate",role:"dialog","aria-modal":"true",children:[u&&(0,t.jsxs)("p",{children:['Deseja realmente excluir o chat "',o,'" ? Essa ação é irreversível e as mensagens desse chat serão apagadas']}),d&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"Renomear chat:"}),(0,t.jsx)("input",{ref:c,type:"text",value:i,onChange:e=>l(e.target.value),onKeyPress:e=>"Enter"===e.key&&void((!d||i.trim())&&r(d?i.trim():void 0)),maxLength:50})]}),(0,t.jsxs)("div",{className:"modal-actions",children:[(0,t.jsx)("button",{className:"cancelar",onClick:s,children:"Cancelar"}),(0,t.jsx)("button",{className:"confirm",onClick:()=>r(d?i.trim():void 0),children:u?"Confirmar Exclusão":"Salvar Novo Nome"})]})]})})}var i=e.i(40141);function l(e){return(0,i.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10zM8 13.01l1.41 1.41L11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01z"},child:[]}]})(e)}function c(e){return(0,i.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"},child:[]}]})(e)}var d=e.i(67789);function u(e){let{onFileUploaded:a,onClose:o,activeConversation:s}=e,[r,i]=(0,n.useState)(!1),[u,m]=(0,n.useState)(null),h=async e=>{let t=e.target.files[0];if(t&&s){i(!0),m(null);try{var n;let e=await d.api.uploadDocument(t),s=null==e||null==(n=e.document)?void 0:n._id;if(!s)throw Error("ID do documento não recebido da API. Verifique a resposta do servidor.");alert('Arquivo "'.concat(t.name,'" enviado com sucesso!')),a&&s&&a(s),o()}catch(e){console.error("Erro no upload do arquivo:",e),m(e.message||"Erro ao enviar arquivo.")}finally{i(!1)}}};return(0,t.jsx)("div",{className:"modal-overlay",children:(0,t.jsxs)("div",{className:"modal add-file-modal modal-animate",children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h3",{children:"Adicionar Arquivo"}),(0,t.jsx)("button",{className:"close-modal-btn",onClick:o,disabled:r,children:(0,t.jsx)(c,{})})]}),(0,t.jsxs)("div",{className:"modal-content",children:[u&&(0,t.jsx)("p",{className:"error-message",children:u}),(0,t.jsxs)("label",{className:"file-upload-label ".concat(r?"disabled":""),children:[(0,t.jsx)(l,{className:"upload-icon"}),(0,t.jsx)("span",{children:r?"Processando...":"Escolher Arquivo"}),(0,t.jsx)("input",{type:"file",onChange:h,disabled:r,style:{display:"none"}})]})]})]})})}function m(e){let{onLogout:n,userEmail:a}=e;return(0,t.jsxs)("div",{className:"profile-menu",children:[(0,t.jsx)("div",{className:"profile-info",children:(0,t.jsx)("span",{children:a})}),(0,t.jsx)("button",{className:"profile-option",onClick:()=>{"function"==typeof n&&n()},type:"button",children:(0,t.jsx)("span",{children:"Sair"})})]})}function h(e){let{activeConversation:a,onOpenAddFileModal:s,onMessageSent:r,attachedDocumentId:i,setAttachedDocumentId:l}=e,[c,u]=(0,n.useState)(""),[m,h]=(0,n.useState)(!1),v=async()=>{let e=c.trim();if(a&&(e||i)&&!m){h(!0),u(""),null==r||r({sender:"user",content:e,id:crypto.randomUUID()});try{let t=(null==a?void 0:a._id)||(null==a?void 0:a.id),n=await d.api.sendMessage(e,t,i);l(null),null==r||r({sender:"bot",content:(null==n?void 0:n.message_content)||(null==n?void 0:n.content)||(null==n?void 0:n.mensagem)||"Resposta da IA não recebida.",id:crypto.randomUUID(),generated_document_id:null==n?void 0:n.document_id})}catch(t){console.error("Erro ao enviar mensagem:",t);let e=i?"Erro de conexão/servidor. O anexo foi mantido. Tente novamente.":"Erro de conexão ou servidor. Tente novamente.";null==r||r({sender:"bot",content:e,id:crypto.randomUUID()})}finally{h(!1)}}},p=i?"Documento anexado (".concat(i.substring(0,4),"...). Digite sua instrução..."):m?"Aguardando resposta...":"Digite sua mensagem...";return(0,t.jsxs)("div",{className:"chat-input ".concat(i?"has-attachment":""),children:[(0,t.jsx)("button",{className:"add-file-btn",onClick:s,disabled:m,children:(0,t.jsx)(o.FiPlus,{className:i?"attached-icon":""})}),(0,t.jsx)("input",{type:"text",placeholder:p,value:c,onChange:e=>u(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),v())},disabled:m}),(0,t.jsx)("button",{className:"send-btn",onClick:v,disabled:m||!c.trim()&&!i,children:(0,t.jsx)(o.FiSend,{})})]})}function v(e){return(0,i.GenIcon)({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6 0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7 0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4 0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9 14.3 0 28-2.7 40.9-6.9 2.3-.7 4.7-1.1 7.1-1.1 42.9 0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"},child:[]}]})(e)}function p(){let[e,a]=(0,n.useState)([]),[o,i]=(0,n.useState)(null),[l,c]=(0,n.useState)([]),[p,x]=(0,n.useState)({name:"Carregando...",email:"carregando@email.com"}),[f,g]=(0,n.useState)(null),[j,y]=(0,n.useState)(!1),[N,b]=(0,n.useState)(!1),[E,w]=(0,n.useState)(null),C=(0,n.useRef)(null);(0,n.useEffect)(()=>{(async()=>{try{if(!localStorage.getItem("token"))return;let[e,t]=await Promise.all([d.api.getConversations(),d.api.getProfile()]);if(a(e),x({name:t.name,email:t.email}),e.length)k(e[0]);else{let e=await d.api.sendMessage("Olá, TPF-AI!");a(t=>[e.conversation,...t]),k(e.conversation)}}catch(e){console.error("Erro ao carregar chat:",e.message)}})()},[]),(0,n.useEffect)(()=>{C.current&&(C.current.scrollTop=C.current.scrollHeight)},[l]);let k=async e=>{i(e),w(null);try{let t=await d.api.getConversationHistory(e._id||e.id);c(t||[])}catch(e){c([])}},S=async(e,t)=>{if(!e||!t)return alert("Título obrigatório");try{await d.api.renameConversation(e,t),a(n=>n.map(n=>n._id===e?{...n,title:t}:n)),_()}catch(e){alert("Erro ao renomear: "+e.message)}},D=async t=>{if(!t)return alert("ID da conversa não encontrado");try{await d.api.deleteConversation(t);let n=e.filter(e=>e._id!==t);a(n),o&&o._id===t&&k(n[0]||null),_()}catch(e){alert("Erro ao excluir: "+e.message)}},_=()=>g(null);return(0,t.jsxs)("div",{className:"chat-container",children:[(0,t.jsxs)("aside",{className:"sidebar",children:[(0,t.jsxs)("h1",{className:"logo",children:["TPF",(0,t.jsx)("span",{children:"-AI"})]}),(0,t.jsx)("button",{className:"new-chat",onClick:async()=>{try{let e=await d.api.sendMessage("Novo chat iniciado!");a(t=>[e.conversation,...t]),k(e.conversation)}catch(e){console.error("Erro ao criar novo chat:",e.message)}},children:"+ Novo Chat"}),(0,t.jsx)("h4",{children:"Histórico"}),(0,t.jsx)("div",{className:"chat-list",children:e.map(e=>(0,t.jsx)(s,{conversation:e,onRename:e=>g({type:"renomear",chat:e}),onDelete:e=>g({type:"excluir",chat:e}),onSelect:k,isActive:(null==o?void 0:o._id)===e._id},e._id))}),(0,t.jsxs)("div",{className:"user-profile",onClick:()=>y(!j),children:[(0,t.jsx)("div",{className:"user-icon-container",children:(0,t.jsx)(v,{size:32,color:"#000000ff"})}),(0,t.jsx)("span",{children:p.name}),j&&(0,t.jsx)(m,{onLogout:()=>window.location.href="/auth/login",userEmail:p.email})]})]}),(0,t.jsxs)("main",{className:"chat-main",children:[(0,t.jsx)("div",{className:"chat-messages",ref:C,children:l.map(e=>(0,t.jsxs)("div",{className:"message-bubble ".concat("user"===e.role?"user":"bot"),children:[e.content,e.generated_document_id&&(0,t.jsx)(DocumentLink,{documentId:e.generated_document_id})]},e._id||e.id))}),(0,t.jsx)(h,{activeConversation:o,onMessageSent:e=>c(t=>[...t,e]),onOpenAddFileModal:()=>b(!0),attachedDocumentId:E,setAttachedDocumentId:w})]}),f&&f.chat&&(0,t.jsx)(r,{type:f.type,chatTitle:f.chat.title,onClose:_,onConfirm:"renomear"===f.type?e=>S(f.chat._id,e):()=>D(f.chat._id)}),N&&(0,t.jsx)(u,{onClose:()=>b(!1),activeConversation:o,onFileUploaded:e=>{w(e),b(!1),alert("Documento anexado! Digite sua instrução e envie.")}})]})}}]);